
# file to inform user of a problem. will be deleted at the end of this script
touch $DEST/opt/openHABian-install-failed

echo "[openHABian] Installing git package... "
do_chroot /usr/bin/apt-get -y install git &>/dev/null

echo "[openHABian] Cloning myself... "
do_chroot /usr/bin/git clone -b master https://github.com/openhab/openhabian.git /opt/openhabian &>/dev/null
ln -s /opt/openhabian/openhabian-setup.sh $DEST/usr/local/bin/openhabian-config

echo -n "[openHABian] Copying first boot script and configuration... "
cp $DEST/opt/openhabian/build-pine64-image/rc.local $DEST/etc/rc.local
cp $DEST/opt/openhabian/build-pine64-image/openhabian.pine64.conf $DEST/etc/openhabian.conf

echo "[openHABian] === Executing 'openhabian-setup.sh' ==="
chroot /rootfs /bin/bash /opt/openhabian/openhabian-setup.sh unattended
if [ $? -eq 0 ]; then
  rm /rootfs/opt/openHABian-install-failed
  touch /rootfs/opt/openHABian-install-successful
else
  touch /rootfs/opt/openHABian-install-failed
fi
echo "[openHABian] === Finished executing 'openhabian-setup.sh' ==="

# vim: filetype=sh
